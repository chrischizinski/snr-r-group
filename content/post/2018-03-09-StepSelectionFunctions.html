---
title: "Step Selection Functions"
date: '2018-03-09'
tags: ["Step selction", "Animal movement", "Data Seminar"]
categories: ["R"]
---



<div id="deer-data" class="section level2">
<h2>Deer data</h2>
<pre class="r"><code>data(&quot;deer&quot;)
glimpse(deer)</code></pre>
<pre><code>## Observations: 826
## Variables: 4
## $ x_     &lt;dbl&gt; 4314068, 4314053, 4314105, 4314044, 4313015, 4312860, 4...
## $ y_     &lt;dbl&gt; 3445807, 3445768, 3445859, 3445785, 3445858, 3445857, 3...
## $ t_     &lt;dttm&gt; 2008-03-30 00:01:47, 2008-03-30 06:00:54, 2008-03-30 1...
## $ burst_ &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2...</code></pre>
<pre class="r"><code>ggplot() +
  geom_path(data = deer,aes(x = x_, y = y_),linetype = &quot;dashed&quot;) +
  geom_point(data = deer,aes(x = x_, y = y_),size = 1, colour = &quot;red&quot;, alpha = 0.5) + 
  coord_equal() + 
  theme_classic()</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/deerdata-1.png" width="672" /></p>
</div>
<div id="investigate-some-of-the-movements" class="section level2">
<h2>Investigate some of the movements</h2>
<pre class="r"><code>ymd(c(&quot;2018-03-09&quot;))</code></pre>
<pre><code>## [1] &quot;2018-03-09&quot;</code></pre>
<pre class="r"><code>mdy(c(&quot;March 09 2018&quot;))</code></pre>
<pre><code>## [1] &quot;2018-03-09&quot;</code></pre>
<pre class="r"><code>mdy_hms(c(&quot;March 09 2018 12:30:02&quot;))</code></pre>
<pre><code>## [1] &quot;2018-03-09 12:30:02 UTC&quot;</code></pre>
<pre class="r"><code>summarize_sampling_rate(deer)</code></pre>
<pre><code>## # A tibble: 1 x 9
##   min       q1       median   mean     q3       max         sd     n unit 
##   &lt;S3: tab&gt; &lt;S3: ta&gt; &lt;S3: ta&gt; &lt;S3: ta&gt; &lt;S3: ta&gt; &lt;S3: ta&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;
## 1 5.964444  5.996667 6.005833 11.46179 6.016111 3923.997  137.   825 hour</code></pre>
<pre class="r"><code>head(deer)</code></pre>
<pre><code>## # A tibble: 6 x 4
##         x_       y_ t_                  burst_
## *    &lt;dbl&gt;    &lt;dbl&gt; &lt;dttm&gt;               &lt;dbl&gt;
## 1 4314068. 3445807. 2008-03-30 00:01:47      1
## 2 4314053. 3445768. 2008-03-30 06:00:54      1
## 3 4314105. 3445859. 2008-03-30 12:01:47      1
## 4 4314044. 3445785. 2008-03-30 18:01:24      1
## 5 4313015. 3445858. 2008-03-31 00:01:23      1
## 6 4312860. 3445857. 2008-03-31 06:01:45      1</code></pre>
<pre class="r"><code># Calculate the time intervals between relocations
time_interval&lt;-interval(deer$t_[-length(deer$t_)], deer$t_[-1])

head(as.period(time_interval, units = &quot;hours&quot;))</code></pre>
<pre><code>## [1] &quot;5H 59M 7S&quot;  &quot;6H 0M 53S&quot;  &quot;5H 59M 37S&quot; &quot;5H 59M 59S&quot; &quot;6H 0M 22S&quot; 
## [6] &quot;5H 59M 26S&quot;</code></pre>
<pre class="r"><code>step_time &lt;- data.frame(time_hr = as.numeric(as.period(time_interval, units = &quot;sec&quot;))/3600)

# Histogram
ggplot(data = step_time) + 
  geom_histogram(aes(x = time_hr), binwidth = 1, boundary = 0, closed = &quot;left&quot;,
                 fill = &quot;dodgerblue&quot;, colour = &quot;black&quot;) + 
  scale_x_continuous(limits = c(0,15), breaks = 1:15) +
  coord_cartesian(ylim = c(0,800), xlim = c(0,15), expand = FALSE) +
  theme_classic()</code></pre>
<pre><code>## Warning: Removed 5 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/samplingrate-1.png" width="672" /></p>
</div>
<div id="examing-the-raster-data" class="section level2">
<h2>Examing the raster data</h2>
<pre class="r"><code>data(&quot;sh_forest&quot;)
sh_forest</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 720, 751, 540720  (nrow, ncol, ncell)
## resolution  : 25, 25  (x, y)
## extent      : 4304725, 4323500, 3437725, 3455725  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
## data source : in memory
## names       : sh.forest 
## values      : 1, 2  (min, max)</code></pre>
<pre class="r"><code>plot(sh_forest)</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>forest_spdf &lt;- as(sh_forest, &quot;SpatialPixelsDataFrame&quot;)
forest_df &lt;- as.data.frame(forest_spdf)
colnames(forest_df) &lt;-c(&quot;value&quot;, &quot;x&quot;, &quot;y&quot;)


ggplot(data = forest_df) + 
  geom_tile(aes(x, y, fill = factor(value)), alpha = 0.8) +
   geom_path(data = deer,aes(x = x_, y = y_),linetype = &quot;dashed&quot;) +
  geom_point(data = deer,aes(x = x_, y = y_),size = 1, colour = &quot;red&quot;, alpha = 0.5) +
  scale_fill_manual(values = c(&quot;2&quot; = &quot;lightgrey&quot;, &quot;1&quot; = &quot;forestgreen&quot;)) +
  # scale_fill_viridis(option = &quot;inferno&quot;) +
  coord_equal(expand = FALSE) + 
  theme_minimal() +
  theme(legend.position = &quot;bottom&quot;,
        legend.key.width = unit(2, &quot;cm&quot;),
        axis.title = element_blank())</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
</div>
<div id="examine-the-relocation-data" class="section level2">
<h2>Examine the relocation data</h2>
<pre class="r"><code> deer %&gt;% 
  group_by(burst_) %&gt;% 
  summarize(N = n())</code></pre>
<pre><code>## # A tibble: 35 x 2
## # Groups:   [?]
##    burst_     N
##  *  &lt;dbl&gt; &lt;int&gt;
##  1      1    12
##  2      2    80
##  3      3     1
##  4      4     3
##  5      5    15
##  6      6    14
##  7      7    27
##  8      8    70
##  9      9    54
## 10     10     6
## # ... with 25 more rows</code></pre>
<pre class="r"><code>plota &lt;- ggplot() +
  geom_path(data = deer,aes(x = x_, y = y_),linetype = &quot;dashed&quot;) +
  geom_point(data = deer,aes(x = x_, y = y_),size = 1, colour = &quot;red&quot;, alpha = 0.5) + 
  coord_equal() + 
  theme_classic()


plotb&lt;- ggplot(deer %&gt;% distinct(burst_, .keep_all = TRUE)) +
  geom_path(aes(x = x_, y = y_),linetype = &quot;dashed&quot;) +
  geom_point(aes(x = x_, y = y_),size = 1, colour = &quot;blue&quot;, alpha = 0.5) + 
  coord_equal() + 
  theme_classic()

grid.arrange(plota, plotb, ncol = 2)</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/relocations-1.png" width="672" /></p>
<pre class="r"><code>gA &lt;- ggplotGrob(plota)
gB &lt;- ggplotGrob(plotb)

grid::grid.newpage()
grid::grid.draw(gtable_cbind(gA,gB))</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/relocations-2.png" width="672" /></p>
<pre class="r"><code># calculating steps by burst (distance between points, turn angle, time difference) 
deer %&gt;% 
  steps_by_burst() -&gt; ssf1

# Calculate the random steps 
ssf1 %&gt;% 
  random_steps(n = 15) -&gt; ssf1</code></pre>
<pre><code>## Warning in random_steps.steps(., n = 15): Step-lengths or turning angles
## contained NA, which were removed.</code></pre>
<pre class="r"><code># Random angles 
direction_rel(deer) </code></pre>
<pre><code>##   [1]            NA  171.76751904  170.23127792  -54.17295012    4.33011941
##   [6]    8.35002788 -162.90338982  152.43150289  -58.17094474  -12.37528269
##  [11]    5.76019709  -32.19525497   -7.95902923   16.62594768   75.42027420
##  [16]   41.55419600 -137.30992118  170.94562758  -18.89769068 -166.83621968
##  [21]  -78.73825885  -98.19534959 -170.93125024  168.61385715 -178.78095901
##  [26]  -47.59404894 -172.40366580   68.39186445  -11.44284966  162.81121825
##  [31]  100.92798695  130.97775548  -76.72484187 -176.63419928 -169.77775791
##  [36]   76.69698299  111.42045279   82.58166150  -22.40833157 -146.83995459
##  [41]  -43.45871861  -41.69749794   32.01424608  172.35054985 -145.09039817
##  [46]  148.38100955 -115.69852127 -143.48973659  -71.05581845   84.80409969
##  [51] -148.35766342 -173.59524557  150.11884517   37.90775222  -40.17695083
##  [56] -171.39866478   28.21926210  176.26730459  -55.55635134    3.85034765
##  [61] -143.83734003   57.95040113  134.98355501  -53.81154996 -157.77511511
##  [66]   25.42273778 -171.34599273   -2.79329103  156.22716632   26.56612127
##  [71]  -53.96528633 -174.78802269  -69.12243591    6.45034240  -33.45212834
##  [76] -170.10560729 -116.56719671  -77.03656353 -177.76210791 -120.08044868
##  [81]  -41.33521458 -101.54594540  -63.69197045  -30.49928009  -92.57250546
##  [86] -177.69344639 -131.04108820 -111.22843065 -156.04965531   84.96068353
##  [91]   42.11132694  -26.85254761 -110.47255290   27.48693948   -6.87607444
##  [96]  -74.69060996   57.24567083   55.09627409  -79.59154813  128.83100019
## [101] -178.36151378  179.60944479 -174.16321664  173.66176671  127.94035583
## [106]  -54.90831686  -57.23207382   13.88967847   -8.83996601  110.66119435
## [111]  143.69716029 -111.42218743   40.19023662  145.63802763   -1.94636773
## [116] -167.84555714 -167.48464778  178.36121120  158.25626045  164.21129124
## [121]   -9.78207757  178.82665396   42.18919893  179.48881137  -93.78558220
## [126]   29.04684106 -104.98575819    6.50204210  -66.37782062 -163.34077886
## [131]   25.88573108 -168.26675106  -90.31935764 -164.92401314   80.56452661
## [136] -169.40585536  114.39808106  152.93727118  130.08631557 -154.85622704
## [141]   52.35002701 -146.58825740    7.29335712 -115.33261943 -101.39807458
## [146] -175.27227673  -42.37523378 -116.23956603   89.99685638   43.22405402
## [151]  153.93169380  -10.36343981   16.31495500  171.69618916 -119.53921906
## [156]  -88.35690206   53.21016757   71.60115554  175.89035856   -1.60306455
## [161]  175.41741263   -3.26161674  179.28162834  -33.48555941  -94.84998534
## [166]  162.06295356  -49.80261380  -43.35238496 -163.74845428   83.62353139
## [171]  157.04097600   45.92877664   75.41580265   48.88189319  177.23077658
## [176]    5.59259687   78.43918051  108.64582407  173.94168157    5.02446197
## [181]  -57.76413143  104.29816483   91.47460666   22.56900368   58.78172453
## [186]  143.02700959 -172.50690102  153.21360453 -178.45912391   -7.87101808
## [191] -167.26782566   -1.42293769   16.27007864  102.27036399 -120.71913600
## [196]  -99.53805674   33.56820677  -30.65753894  138.31618635   72.17291450
## [201]  111.85002133   25.84091067  114.27735519  -57.14211421 -141.13044783
## [206]   36.30442750 -173.67348109  -17.17886549   -1.47027740   55.14422204
## [211]  161.50875537   79.20075241   -2.88499953  -32.25526504 -120.34507587
## [216]  161.28742925  -83.44457666  179.59019346  -71.21720018  118.79758563
## [221]  100.60345731   -8.88586899  129.90340139  152.39314005   18.75091422
## [226]   -8.70392040 -133.12427035  -97.15376235  130.87540072  123.90463704
## [231]  -74.41010136  -80.71221321   48.15795988 -123.95353401 -103.67295114
## [236] -178.25647104  -58.16397159  -11.81182174  -73.43046973   36.40578190
## [241] -160.16774863  -51.59710017  142.40766081  -44.16164310   95.51569129
## [246]  -77.09761986   27.87963410 -162.05883304  -85.09749350   68.63666145
## [251]   69.95139705 -157.91535011  137.12691215   78.85669449   48.47574974
## [256]  111.48623274 -125.86159998  -58.88349570   23.95236996  -52.32144919
## [261]  -83.38582177 -159.38817425  154.56199715 -103.35484670  -65.24214615
## [266]  169.21503640 -159.78701774  -29.60993372 -152.13679178  -31.20530958
## [271] -174.73700291  -27.21519797  129.78956852  166.55437925 -159.74985749
## [276]  121.87857921   77.88302925  179.24684557 -171.00780076   28.79267869
## [281]   41.35046989  -57.45857048  135.31180091  113.92739061  163.47604617
## [286]   11.22235993  -95.99226775  -60.58212081 -129.81420033 -144.02086817
## [291]  179.68377865   67.73632644  -17.75827494  154.14089803  159.03773119
## [296]   41.43114846 -131.51003560 -106.82866051 -174.30599468  114.59389681
## [301]  -44.70345492  -96.23244488 -137.63150254 -122.68079611  114.95648031
## [306]    0.51729492 -169.83887493   39.80243687   10.92497345  146.93583597
## [311]  176.95227219  174.49920979  145.54846706 -147.65565506  173.33391267
## [316] -152.94539267  152.04912616  -84.52963470  157.60508117  -25.23491172
## [321] -125.23202224  -54.62678854 -147.50622841   87.21760491 -171.45782016
## [326]   59.42832851  -63.12724512 -165.84803147  168.32274251   49.12757097
## [331]  -17.41625905  164.02648116  178.71894670  -20.99885394  -62.03560373
## [336]  -41.04164092 -164.21244489   66.83389993 -130.39783425  153.49399271
## [341]  142.44809887  147.31307320  -29.03061799  123.53284411  166.44733417
## [346]   90.99709632  -91.70602949  157.11922574 -162.69286154  166.61877163
## [351]   75.18567059  -52.95015169  172.67036367   43.46516334   22.62685794
## [356]  153.32564346  178.17825947  172.64896606   18.80308109  -36.16859578
## [361]  115.86597688   90.89406117   -3.09132538  -79.92089765   69.26592254
## [366]  137.45426749   85.12316001 -168.74195905  -76.74803964  -48.67721087
## [371] -108.89519023   31.93386217  170.38279596 -161.63311217  147.88425560
## [376]   50.92364505 -150.57727860   50.22608225  -99.70261089  -86.32330827
## [381]  136.42905547   12.65345907 -166.62350376   -0.02663544 -179.40949403
## [386]  143.98768248   -2.96259217  101.56557542  135.99956002  -80.18386975
## [391] -146.71128110   66.10692088 -162.56688725  -42.81067604  -11.53818739
## [396]  -89.33925753 -179.87348626   92.47769992 -145.40517927  171.77819336
## [401]  -47.43118423 -101.45499007   57.68662949  123.71917076  177.51425803
## [406]  -97.13862214  170.63375468  101.52016687 -161.89512777   50.65881516
## [411] -168.44933551  -87.60472071  148.40180704 -167.42417379 -136.36352662
## [416]  155.66451039  175.71781921  -35.34262417 -115.26343843   38.10822453
## [421] -159.09363818  -91.65538840  -78.54503891  136.51570061 -166.50964334
## [426] -136.53841886  170.29880001  141.90057962  -56.72704767  109.53058823
## [431]  140.50557749  171.76753878   39.18525759   74.23705378   85.40292754
## [436]  -23.71782236   87.54341978   11.28209673   35.32107741   72.90182406
## [441]   84.12222370   27.55526052  -21.74115551   41.63414938 -130.35039271
## [446]  -59.77644401   -4.34835144   17.32931022  104.60539820  170.86649535
## [451]  -18.83105054 -143.44885606  -92.14252316 -177.85584416 -158.73585145
## [456]   33.37964109   14.17604805   40.38542781  122.39582207  166.22959506
## [461]   65.17020677  109.84742193  -46.72107772  120.00805488   62.57369476
## [466] -178.60822347  -50.59142351  -99.86770951 -153.92273428 -175.30876864
## [471]  115.21503192 -136.40094389   68.96883431 -133.90116741  -81.28509270
## [476]   20.44126879 -169.69654553  124.38889653   71.31855390 -136.54511733
## [481]  -76.04125075  -43.25062263  -31.12713343  -27.99691779  160.78925820
## [486]  172.58544408   64.03408403  174.41868930  178.02520834 -138.94436154
## [491]  -43.17069622 -153.11690957  105.28765743  138.57165022  -33.22414026
## [496]  134.22860947  -35.26880442   22.55041395  -94.95458302  -79.24051577
## [501]  -94.42192826    3.75577392   53.33045373  -12.86306224 -156.84119501
## [506]   26.31459905 -109.48530080   68.75939008    8.95208002 -138.30519836
## [511]  127.89543208   39.22210007  126.97505345 -134.04967207  145.30573228
## [516]   91.76405140  155.11296207 -158.82593491 -127.32134251 -154.26959192
## [521]   63.04864635   38.32852546   20.42501404 -179.23940334 -135.89438788
## [526] -135.79505078 -151.05914439 -175.42905522   13.15884177  140.54530654
## [531]   93.80929275  150.62420895  135.17770566   -7.26275865   55.80331364
## [536]   -8.49463245  173.89210733  162.32689811  -30.73393742  -89.54144219
## [541] -103.89784199  122.28973617  120.53582363 -135.94785823   67.86524644
## [546]  -16.23409780 -157.17569106 -139.77030153  164.11603929   13.26056503
## [551]  -39.51013762  -62.95888389 -172.62666490  -79.53997118  -65.85942641
## [556] -147.70137453  -16.68173094 -157.24594786  161.24296746  -52.42555709
## [561]  -15.33218039   -4.58048102   49.62113117   47.40951714  159.85973480
## [566]   31.26055472  -13.11840952   98.85054938  114.79628514  127.44957389
## [571] -170.25195632  -20.34695032 -176.23472626  124.48177525  -80.27410272
## [576]  156.59359384 -131.20345509 -108.52136732   58.71631832  -59.80853779
## [581]  109.62461138   60.35189622   68.70033249  103.01054527  111.87259427
## [586]  135.38698437  -57.07490148 -106.68789634  108.14966014  -45.52114855
## [591]   44.05947620  138.51385856  -23.47866071 -122.32456571   81.24663250
## [596]  -43.67314501  173.66720671  118.75597807   89.72214787  -44.81561115
## [601]  -23.70483420   98.16882639  -10.50738860  108.41380949  176.92918828
## [606]  -47.51156053   10.37728219 -103.09478505   46.93799316 -144.01511659
## [611]    5.10609808   25.83274335  -87.56392292  -85.60798818  -59.22857120
## [616] -123.85522523    2.70130684  -44.45309052 -157.42531643  -20.61477788
## [621]   51.90380241  -94.83181276  -49.36980902 -106.00243404 -113.91080213
## [626]  -68.45918313  111.64192188  176.41946666 -134.58880385  104.57255457
## [631]   -6.95580335  -31.40818801  -14.19970837 -175.73123697  -27.03459305
## [636]  100.31711291 -140.42038309  -27.14140437  -82.42749798   14.84383926
## [641]  176.26348740  123.49885385  -79.91637802  161.24529812 -126.78449536
## [646] -147.43643550  -51.48757624   53.49372974 -100.34849178  -74.14882963
## [651]   -4.52433815  136.12339558  131.82109286   -5.51227453 -152.82549981
## [656]  -22.05869514   27.18921955 -149.55106046 -143.54885713  -22.12375685
## [661] -107.87983789 -136.28025200  -93.88860946 -141.15427554   65.74360249
## [666]  125.33999180  -56.59065513  -66.47781475   40.29560727  137.06208988
## [671]  -98.32782401 -106.05884413 -163.39238566  155.79720606  -54.74808162
## [676] -136.74334267  -37.29233049   20.44691825   43.24833346 -126.99106099
## [681]  -66.92466842 -122.96502388 -171.09428988  159.22010768   34.58917716
## [686]   19.79016389  153.84254415  138.61456048  -22.54591755  159.18607834
## [691]  -19.82821787  -71.94203836   51.64316147  114.17501789  -65.66992679
## [696] -165.02715807    5.29190719   92.92383526  148.73108009  175.81985518
## [701]  -89.97743604  127.79645408  131.35514590  167.74391785    7.22189637
## [706]  169.43794644  -26.04973787  166.63152463  133.87679595   52.25129023
## [711]  -10.66340240  -41.65898167 -104.24403477 -143.56266859  132.96936565
## [716]  -64.61344559 -153.72480696   53.55137177  144.11535950    9.72955251
## [721] -135.54741287  -24.88645392 -169.60093360   61.41062638  125.50584114
## [726]  -49.30122894 -164.19889884   97.51417528  115.02438535   93.09912939
## [731]  119.87810038  145.87087472 -146.57871941  133.68658673 -135.26894833
## [736] -160.88901694   25.14504350 -111.05087848  171.76548557 -124.98718797
## [741]  -61.38465951 -137.85674698  -25.94171520 -177.11848004   99.93858710
## [746]   91.83332052   72.95596266  116.44950359   20.51968331  176.40092752
## [751] -139.30856857  -43.88676019  -44.74211796  175.69045032 -129.51515977
## [756]   38.98725405  -37.50771646   52.64157110  -20.93126859  151.58133933
## [761]  122.50066035  -16.43502278   63.75945754  111.14731539   10.99200947
## [766]  -83.37741269  135.40740598  -82.35649757  147.62469755  -83.52159527
## [771]   87.04800827  150.56509037  -75.74736975  176.27418499   63.14531312
## [776]  160.86859199   37.85991391   63.04125379 -137.26005582  147.02383720
## [781]   85.59801971  161.72581932 -153.06962552  -85.47843834   98.40076924
## [786]  -49.61998291  -73.79733040  -87.09021289    2.82761193   55.55367020
## [791] -111.83280063  101.18834622 -109.74294178    5.13479993  -58.79783925
## [796]  114.72052191   55.88185937  161.73972504 -163.22321028 -178.75711535
## [801]  -84.40380800  174.86681245 -116.55979264 -178.10721892  118.59415172
## [806]  -53.07560045  103.86046522 -168.59723632  -82.79093895  143.33109322
## [811]  159.06663214  130.60901187    0.43688975  125.90303841   62.34802377
## [816]  -89.22110504 -106.44731644 -140.07061858 -114.61075642  -62.26396014
## [821]   61.54258808  155.27747140  -40.76356086 -102.21506065  -64.25338534
## [826]            NA</code></pre>
<pre class="r"><code>mean(direction_rel(deer), na.rm = TRUE) </code></pre>
<pre><code>## [1] 0.7044382</code></pre>
<pre class="r"><code>circ_data &lt;- rvonmises(1000, mu = mean(direction_rel(deer), na.rm = TRUE) , kappa = 4)</code></pre>
<pre><code>## Warning in as.circular(x): an object is coerced to the class &#39;circular&#39; using default value for the following components:
##   type: &#39;angles&#39;
##   units: &#39;radians&#39;
##   template: &#39;none&#39;
##   modulo: &#39;asis&#39;
##   zero: 0
##   rotation: &#39;counter&#39;
## conversion.circularmuradians0counter</code></pre>
<pre class="r"><code>plot(circ_data)</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/stepanalysis-1.png" width="672" /></p>
<pre class="r"><code>ggplot(circ_data %&gt;% as.data.frame ) +
  geom_histogram(aes(x = x), binwidth = 0.25, fill = &quot;white&quot;, color = &quot;black&quot;) +
  coord_polar(start = 0, direction = 1) +
  scale_x_continuous(breaks = seq(0,2*pi, by = pi/2), expand = c(0,0), limits = c(0,2*pi)) +
  scale_size_area()</code></pre>
<p><img src="/post/2018-03-09-StepSelectionFunctions_files/figure-html/stepanalysis-2.png" width="672" /></p>
<pre class="r"><code># Extract environmental variables at the random steps 

ssf1 %&gt;% 
  extract_covariates(sh_forest) -&gt; ssf1

## Chain
deer %&gt;% 
  steps_by_burst() %&gt;% 
  random_steps(n = 15) %&gt;% 
  extract_covariates(sh_forest) %&gt;% 
  mutate(forest = case_when(sh.forest == 1 ~ &quot;forest&quot;,
                            sh.forest == 2 ~ &quot;not forest&quot;),
         forest = as.factor(forest),
         cos_ta = cos(ta_),
         log_sl = log(sl_)) -&gt; deer_ssf</code></pre>
<pre><code>## Warning in random_steps.steps(., n = 15): Step-lengths or turning angles
## contained NA, which were removed.</code></pre>
<pre class="r"><code>glimpse(deer_ssf)</code></pre>
<pre><code>## Observations: 12,144
## Variables: 16
## $ burst_    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1...
## $ step_id_  &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2...
## $ case_     &lt;lgl&gt; TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS...
## $ x1_       &lt;dbl&gt; 4314053, 4314053, 4314053, 4314053, 4314053, 4314053...
## $ y1_       &lt;dbl&gt; 3445768, 3445768, 3445768, 3445768, 3445768, 3445768...
## $ x2_       &lt;dbl&gt; 4314105, 4314597, 4314395, 4314124, 4314053, 4313853...
## $ y2_       &lt;dbl&gt; 3445859, 3445925, 3444874, 3446085, 3445859, 3445976...
## $ t1_       &lt;dttm&gt; 2008-03-30 06:00:54, 2008-03-30 06:00:54, 2008-03-3...
## $ t2_       &lt;dttm&gt; 2008-03-30 12:01:47, 2008-03-30 12:01:47, 2008-03-3...
## $ dt_       &lt;time&gt; 6.014722 hours, 6.014722 hours, 6.014722 hours, 6.0...
## $ sl_       &lt;dbl&gt; 104.3029779, 548.2122623, 1042.2320750, 237.6622856,...
## $ ta_       &lt;dbl&gt; 171.76752, -62.71085, 130.71033, -99.26650, -49.2651...
## $ sh.forest &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2...
## $ forest    &lt;fct&gt; not forest, not forest, not forest, not forest, not ...
## $ cos_ta    &lt;dbl&gt; -0.5233004, 0.9926885, 0.3280437, 0.3015675, 0.54000...
## $ log_sl    &lt;dbl&gt; 4.6472999, 6.3066626, 6.9491199, 5.4708507, -0.15184...</code></pre>
<pre class="r"><code>deer_ssf %&gt;% 
  fit_clogit(case_ ~ forest + strata(step_id_)) -&gt; m0
summary(m0)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(rep(1, 12144L), case_) ~ forest + strata(step_id_), 
##     data = data, method = &quot;exact&quot;)
## 
##   n= 12144, number of events= 759 
## 
##                     coef exp(coef) se(coef)      z Pr(&gt;|z|)    
## forestnot forest -0.6062    0.5454   0.1084 -5.591 2.25e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                  exp(coef) exp(-coef) lower .95 upper .95
## forestnot forest    0.5454      1.833     0.441    0.6746
## 
## Rsquare= 0.002   (max possible= 0.293 )
## Likelihood ratio test= 30.06  on 1 df,   p=4e-08
## Wald test            = 31.26  on 1 df,   p=2e-08
## Score (logrank) test = 31.48  on 1 df,   p=2e-08</code></pre>
<pre class="r"><code> 0.6489/(1+ 0.6489)</code></pre>
<pre><code>## [1] 0.3935351</code></pre>
<pre class="r"><code>m0 &lt;- clogit(case_ ~ forest + strata(step_id_), data=deer_ssf)
summary(m0)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(rep(1, 12144L), case_) ~ forest + strata(step_id_), 
##     data = deer_ssf, method = &quot;exact&quot;)
## 
##   n= 12144, number of events= 759 
## 
##                     coef exp(coef) se(coef)      z Pr(&gt;|z|)    
## forestnot forest -0.6062    0.5454   0.1084 -5.591 2.25e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                  exp(coef) exp(-coef) lower .95 upper .95
## forestnot forest    0.5454      1.833     0.441    0.6746
## 
## Rsquare= 0.002   (max possible= 0.293 )
## Likelihood ratio test= 30.06  on 1 df,   p=4e-08
## Wald test            = 31.26  on 1 df,   p=2e-08
## Score (logrank) test = 31.48  on 1 df,   p=2e-08</code></pre>
<pre class="r"><code>newdata = expand.grid(forest=unique(deer_ssf$forest),
                      step_id_ = unique(deer_ssf$step_id_) )

pred_data &lt;- augment(m0, newdata=newdata, type.predict=&#39;risk&#39;) 
 
 pred_data %&gt;% 
   mutate(prob = .fitted / (1+.fitted)) %&gt;% 
   group_by(forest) %&gt;% 
   summarise(prob = mean(prob)) -&gt; pred_summ
 
 pred_data %&gt;%
   filter(step_id_ == 100) %&gt;% 
   mutate(prob = .fitted / (1+.fitted),
          sumP = sum(prob))</code></pre>
<pre><code>## # A tibble: 2 x 6
##   forest     step_id_ .fitted .se.fit  prob  sumP
##   &lt;fct&gt;         &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 not forest      100   0.635  0.0648 0.388 0.926
## 2 forest          100   1.16   0.0292 0.538 0.926</code></pre>
</div>
